<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recap Script Writer (Burmese)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Padauk', sans-serif;
        }
        .chat-bubble-bot {
            background-color: #e2e8f0; /* gray-200 */
            color: #1a202c; /* gray-800 */
            border-radius: 20px 20px 20px 5px;
            align-self: flex-start;
        }
        .btn-secondary {
            background-color: #6366f1; /* indigo-500 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4f46e5; /* indigo-600 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8">
        <div class="flex items-center mb-6">
            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                </svg>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-gray-800">AI á€‡á€¬á€á€ºá€œá€™á€ºá€¸á€¡á€€á€»á€‰á€ºá€¸á€á€»á€¯á€•á€º á€›á€±á€¸á€á€¬á€¸á€á€°</h1>
                <p class="text-gray-500">AI Movie Recap Script Writer</p>
            </div>
        </div>

        <!-- Chat Area -->
        <div id="chat-area" class="space-y-6">
            <div class="chat-bubble-bot p-4 max-w-lg">
                <p class="font-bold mb-2">á€™á€„á€ºá€¹á€‚á€œá€¬á€•á€« ğŸ‘‹</p>
                <p>á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€€ AI á€€á€­á€¯á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ á€‡á€¬á€á€ºá€œá€™á€ºá€¸á€¡á€…á€¡á€†á€¯á€¶á€¸ Recap Script á€á€½á€±á€€á€­á€¯ á€›á€±á€¸á€•á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€‡á€¬á€á€ºá€€á€¬á€¸á€”á€¬á€™á€Šá€ºá€”á€²á€· Script á€¡á€›á€¾á€Šá€ºá€€á€­á€¯á€á€¬ á€›á€½á€±á€¸á€•á€±á€¸á€•á€«á‹</p>
            </div>

            <!-- User Input Form -->
            <div id="user-form" class="bg-gray-50 p-6 rounded-lg space-y-4">
                <div>
                    <label for="movieTitle" class="block text-sm font-medium text-gray-700 mb-1">áá‹ á€‡á€¬á€á€ºá€€á€¬á€¸á€”á€¬á€™á€Šá€º (á€¡á€„á€ºá€¹á€‚á€œá€­á€•á€ºá€œá€­á€¯)</label>
                    <input type="text" id="movieTitle" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Parasite">
                </div>
                <div>
                    <label for="scriptLength" class="block text-sm font-medium text-gray-700 mb-1">á‚á‹ Script á€¡á€›á€¾á€Šá€º (Video Length)</label>
                    <select id="scriptLength" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="short (3-5 minute video)">á€¡á€á€­á€¯ (3-5 á€™á€­á€”á€…á€ºá€…á€¬)</option>
                        <option value="medium (8-12 minute video)" selected>á€¡á€œá€šá€ºá€¡á€œá€á€º (8-12 á€™á€­á€”á€…á€ºá€…á€¬)</option>
                        <option value="long (15+ minute video)">á€¡á€›á€¾á€Šá€º (15+ á€™á€­á€”á€…á€ºá€…á€¬)</option>
                    </select>
                </div>
                <button id="generateBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                    <span id="btn-text">Script á€›á€±á€¸á€•á€«</span>
                </button>
            </div>
            
            <div id="status-container"></div>

            <!-- Recap Output -->
            <div id="recap-output" class="hidden">
                 <div class="chat-bubble-bot p-6 max-w-full">
                    <h3 class="text-xl font-bold mb-3">á€á€„á€·á€ºá€¡á€á€½á€€á€º Movie Recap Script á€¡á€á€„á€·á€ºá€–á€¼á€…á€ºá€•á€«á€•á€¼á€®!</h3>
                    <p class="text-sm text-gray-600 mb-3">á€…á€­á€á€ºá€á€„á€ºá€…á€¬á€¸á€…á€›á€¬á€€á€±á€¬á€„á€ºá€¸á€á€±á€¬ á€¡á€á€”á€ºá€¸á€™á€»á€¬á€¸á€¡á€á€½á€€á€º á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸á€¡á€á€»á€­á€”á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€±á€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</p>
                    <textarea id="script-content" class="w-full h-96 bg-white p-4 rounded-lg border border-gray-200 space-y-3 whitespace-pre-wrap text-sm" readonly></textarea>
                    <button id="copyBtn" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-300">Script á€€á€­á€¯ Copy á€€á€°á€¸á€•á€«</button>
                    <span id="copy-success" class="text-green-600 ml-2 hidden">á€€á€°á€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!</span>
                 </div>
            </div>

            <!-- Post-generation features -->
            <div id="post-generation-features" class="hidden bg-gray-50 p-6 rounded-lg space-y-4">
                <h3 class="text-lg font-bold text-gray-800">á€”á€±á€¬á€€á€ºá€á€…á€ºá€†á€„á€·á€ºá€¡á€á€½á€€á€º AI á€¡á€€á€°á€¡á€Šá€®</h3>
                <p class="text-sm text-gray-600">Script á€›á€•á€¼á€®á€†á€­á€¯á€á€±á€¬á€· Video á€¡á€á€½á€€á€º á€á€±á€«á€„á€ºá€¸á€…á€‰á€ºáŠ á€–á€±á€¬á€ºá€•á€¼á€á€»á€€á€ºá€”á€²á€· Thumbnail Idea á€á€½á€±á€€á€­á€¯ AI á€€á€­á€¯ á€á€…á€ºá€á€«á€á€Šá€ºá€¸á€á€­á€¯á€„á€ºá€¸á€œá€­á€¯á€€á€ºá€•á€«á‹</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <button id="generateVideoPackBtn" class="w-full btn-secondary font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                        âœ¨ Title, Description & Thumbnail Ideas á€›á€šá€°á€•á€«
                    </button>
                    <button id="resetBtn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                        ğŸ” á€”á€±á€¬á€€á€ºá€á€…á€ºá€á€¯ á€¡á€á€…á€ºá€œá€¯á€•á€ºá€•á€«
                    </button>
                </div>
            </div>
            
            <div id="additional-content-status"></div>
            <div id="additional-content-output"></div>

        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const userForm = document.getElementById('user-form');
        const recapOutputDiv = document.getElementById('recap-output');
        const scriptContentTextarea = document.getElementById('script-content');
        const copyBtn = document.getElementById('copyBtn');
        const copySuccessMsg = document.getElementById('copy-success');
        const statusContainer = document.getElementById('status-container');
        
        // New and updated elements
        const postGenerationFeaturesDiv = document.getElementById('post-generation-features');
        const generateVideoPackBtn = document.getElementById('generateVideoPackBtn');
        const resetBtn = document.getElementById('resetBtn');
        const additionalContentStatus = document.getElementById('additional-content-status');
        const additionalContentOutput = document.getElementById('additional-content-output');
        
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent`;
        
        let currentMovieTitle = "";

        function showStatus(container, message, isError = false) {
            const statusBubble = document.createElement('div');
            statusBubble.className = `chat-bubble-bot p-4 max-w-lg flex items-center space-x-3 mt-4 ${isError ? 'bg-red-100 text-red-800' : ''}`;
            
            if (!isError) {
                statusBubble.innerHTML = `
                    <svg class="animate-spin h-5 w-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>${message}</span>`;
            } else {
                statusBubble.innerHTML = `<span>${message}</span>`;
            }
            container.innerHTML = '';
            container.appendChild(statusBubble);
        }

        async function callGeminiAPI(payload, statusContainer, statusMessage) {
            showStatus(statusContainer, statusMessage);
            let lastError;
            const retries = 3;
            const delay = 1000;
            const apiKey = "AIzaSyDMKJwGIgiwjftOSbJnmCzr90zwSJtQDUA"; // This MUST be blank. The environment handles auth.

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(`${API_URL}?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (!text) {
                            throw new Error("API response is valid but missing expected content.");
                        }
                        statusContainer.innerHTML = '';
                        return text;
                    }

                    const errorBody = await response.text();
                    let errorMessage = `Request failed with status ${response.status} (${response.statusText})`;
                    if (errorBody) {
                        try {
                            const errorJson = JSON.parse(errorBody);
                            errorMessage += `: ${errorJson.error?.message || 'No detailed message.'}`;
                        } catch (e) {
                            errorMessage += ` | Response body: ${errorBody}`;
                        }
                    }
                    
                    lastError = new Error(errorMessage);
                    console.error(`Attempt ${i + 1} failed:`, lastError);

                } catch (error) {
                    lastError = error;
                    console.error(`Attempt ${i + 1} failed with exception:`, error);
                }

                if (i < retries - 1) {
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }

            console.error('All retries failed.', lastError);
            showStatus(statusContainer, `An error occurred: ${lastError.message}`, true);
            throw lastError;
        }
        
        async function generateMainScript(movieTitle, scriptLength) {
            const systemPrompt = `You are a creative and engaging Burmese movie recap scriptwriter. Your task is to write a detailed, scene-by-scene movie recap script from start to finish based on a given movie title. The script should be divided into an introduction, the main recap body, and a conclusion. It must be written entirely in the Burmese language. The tone should be engaging and narrative. Crucially, for interesting or major plot points and key scenes, you must include an estimated timestamp in the format '[Minute: MM:SS]' right before describing the scene. Estimate these timestamps based on your knowledge of the movie's plot and typical film pacing. Do not provide a review or personal opinion, only narrate the story's events as they happen.`;
            const userQuery = `Write a ${scriptLength} movie recap script for the movie '${movieTitle}'. Use your knowledge to find the plot and create a complete script.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{"google_search": {}}],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            return callGeminiAPI(payload, statusContainer, "á€‡á€¬á€á€ºá€œá€™á€ºá€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€›á€¾á€¬á€–á€½á€±á€•á€¼á€®á€¸ Script á€›á€±á€¸á€á€¬á€¸á€”á€±á€•á€«á€á€Šá€º...");
        }
        
        generateBtn.addEventListener('click', async () => {
            currentMovieTitle = document.getElementById('movieTitle').value.trim();
            const scriptLength = document.getElementById('scriptLength').value;

            if (!currentMovieTitle) {
                showStatus(statusContainer, 'á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€‡á€¬á€á€ºá€€á€¬á€¸á€”á€¬á€™á€Šá€ºá€€á€­á€¯ á€–á€¼á€Šá€·á€ºá€…á€½á€€á€ºá€•á€«á‹', true);
                return;
            }

            userForm.style.display = 'none';
            recapOutputDiv.classList.add('hidden');
            postGenerationFeaturesDiv.classList.add('hidden');
            additionalContentOutput.innerHTML = '';
            statusContainer.innerHTML = '';
            additionalContentStatus.innerHTML = '';

            try {
                const script = await generateMainScript(currentMovieTitle, scriptLength);
                scriptContentTextarea.value = script;
                recapOutputDiv.classList.remove('hidden');
                postGenerationFeaturesDiv.classList.remove('hidden');
            } catch (error) {
                userForm.style.display = 'block';
            }
        });
        
        generateVideoPackBtn.addEventListener('click', async () => {
            const scriptContent = scriptContentTextarea.value;
            if (!scriptContent) return;

            const systemPrompt = `You are a YouTube marketing expert specializing in movie recaps. Your task is to generate a complete 'Video Pack' based on a provided Burmese movie recap script. This pack includes:
1.  **5 catchy video titles.**
2.  **1 SEO-friendly video description.**
3.  **3 distinct, visually compelling thumbnail ideas.**
You MUST respond in a single, valid JSON object. The output language must be Burmese. The JSON structure should be:
{
  "titles": ["...", "...", "...", "...", "..."],
  "description": "...",
  "thumbnail_ideas": [
    {"title": "...", "description": "..."},
    {"title": "...", "description": "..."},
    {"title": "...", "description": "..."}
  ]
}`;
            const userQuery = `Based on the following script for the movie '${currentMovieTitle}', generate the complete Video Pack in the specified JSON format.\n\nSCRIPT:\n${scriptContent}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                generationConfig: { responseMimeType: "application/json" },
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const resultText = await callGeminiAPI(payload, additionalContentStatus, "Video Pack á€€á€­á€¯ AI á€€á€–á€”á€ºá€á€®á€¸á€”á€±á€•á€«á€á€Šá€º...");
                const resultJson = JSON.parse(resultText);
                
                let htmlOutput = `<div class="chat-bubble-bot p-6 max-w-full mt-4 space-y-6">`;
                
                htmlOutput += `<div><h4 class="font-bold text-lg mb-2">âœ¨ Video Titles</h4><ul class="list-disc list-inside space-y-1">`;
                resultJson.titles.forEach(title => {
                    htmlOutput += `<li>${title}</li>`;
                });
                htmlOutput += `</ul></div>`;
                
                htmlOutput += `<div><h4 class="font-bold text-lg mb-2">âœ¨ Video Description</h4>`;
                htmlOutput += `<p class="bg-white p-3 rounded-md text-sm whitespace-pre-wrap">${resultJson.description}</p></div>`;
                
                htmlOutput += `<div><h4 class="font-bold text-lg mb-3">âœ¨ Thumbnail Ideas</h4><div class="space-y-4">`;
                resultJson.thumbnail_ideas.forEach((idea, index) => {
                    htmlOutput += `<div class="bg-white p-3 rounded-md">
                        <p class="font-semibold">Idea ${index + 1}: ${idea.title}</p>
                        <p class="text-sm mt-1">${idea.description}</p>
                    </div>`;
                });
                htmlOutput += `</div></div>`;

                htmlOutput += `</div>`;
                additionalContentOutput.innerHTML = htmlOutput;

            } catch(e) { /* Error already handled by callGeminiAPI */ }
        });

        resetBtn.addEventListener('click', () => {
            userForm.style.display = 'block';
            
            recapOutputDiv.classList.add('hidden');
            postGenerationFeaturesDiv.classList.add('hidden');
            additionalContentOutput.innerHTML = '';
            statusContainer.innerHTML = '';
            additionalContentStatus.innerHTML = '';

            document.getElementById('movieTitle').value = '';
            scriptContentTextarea.value = '';
            currentMovieTitle = '';
        });

        copyBtn.addEventListener('click', () => {
            scriptContentTextarea.select();
            scriptContentTextarea.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                copySuccessMsg.classList.remove('hidden');
                setTimeout(() => {
                    copySuccessMsg.classList.add('hidden');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        });
    </script>
</body>
</html>

